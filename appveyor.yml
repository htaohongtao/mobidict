version: '1.1-beta{build}'

image: Visual Studio 2017

build:
     verbosity: detailed

install:
- cmd: >-
    mkdir C:\projects\deps

    cd C:\projects\deps

    set NINJA_URL="https://github.com/ninja-build/ninja/releases/download/v1.8.2/ninja-win.zip"

    appveyor DownloadFile %NINJA_URL% -FileName ninja.zip

    7z x ninja.zip -oC:\projects\deps\ninja > nul

    set PATH=C:\projects\deps\ninja;%PATH%

    vcpkg install zlib:x64-windows-static

    ninja --version
    
    cmake --version

before_build:
- cmd: >-
    call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"

build_script:
- cmd: >-
    cd C:\projects\mobidict

    git submodule init

    git submodule update

    mkdir build

    cd build

    set PATH=C:\Qt\5.9.2\msvc2017_64\bin;%PATH%

    cmake -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DVCPKG_TARGET_TRIPLET=x64-windows-static -DCMAKE_TOOLCHAIN_FILE=C:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake ..

    ninja

    set PATH=C:\Program Files (x86)\NSIS\bin%PATH%

    cpack
