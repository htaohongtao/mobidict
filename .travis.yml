os:
- osx
osx_image: xcode9.1
sudo: required
dist: trusty
language: c++
compiler:
- clang
deploy:
  provider: pages
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  local_dir: dist
  on:
    branch: master
env:
  global:
  - secure: "eh8zddrsbIhiM+1V/IVCGmC9klus84ogUbOIjB3Tom5bTdM6FnxVh9HSvFmZxHBkxg8Fof2ub3AR94gLXvKPFUFlANm2cGkmK1yL2VYboDz3FHjdtPNnW4RSgR0TVN3SehSlLz3Ny4G+JXSilbKxov694Fl0gMuvK/uFv8GfhKbeb2jqSVI07UYsDWrDDSeqLe852mRv75D+77RYScVqL4fwQVa/wRngN3Ry5RIgv9iRjzfp3EfLUZ5hkUTt89uKoeXWt2CIUFret0hD2K+2V9XeTDsLNBj6UmH5x7IDdvK+wpps9t1RMdeMnEsDFY/d1FV1cAcK9/1afr4FwnWiZUB7ysFNW3xv/I30r33LWVIPAiGicP971qJ4ApVYM2n3/26WmpOuqDZGDBuIuhDjhkOn10GYeU6nitJMZm58pnG28ZsrdCXahKb+p0Kp64udZ5e4Ay81pL/1ipyocnJOYbSnhXerxu+cN2HJCwAeXQI0yuJjXbPp7Xd3QxV5S46AZAn+KvyQ0TN7Wjvf50BbMDz7xrWyYpwX0O7bfiqQqIft0YKC5OoWJ8WzXaJJk9UcVShyeICa2MUt62tjOL5upAuwUrz2UU72RgczEX5KeAejMgbxyfdPi9zkj5VZS+b6C0/+w5mQp0hAgAKpnOJSGmjsM1vDJR5J3fNek+Z5Dno="
before_install:
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then
    sudo apt-get update -qq;
    sudo apt-get install -y build-essential;
    sudo apt-get install -y qtbase5-dev;
    sudo apt-get install -y ninja-build;
  elif [ "$TRAVIS_OS_NAME" == "osx" ]; then
    brew update > /dev/null;
    brew install ninja;
    brew install qt5;
    brew install tree;
    export PATH=/usr/local/opt/qt/bin:$PATH;
  fi
script:
- mkdir build
- cd libmobi ; patch -p1 < ../libmobi.patch; cd ..
- cd build
- cmake -G Ninja ..
- ninja || exit 1
- if [ "$TRAVIS_OS_NAME" == "osx" ]; then
    /usr/local/opt/qt/bin/macdeployqt mobidict.app;
    tree mobidict.app;
    hdiutil create mobidict.dmg -volname "Mobidict" -fs HFS+ -srcfolder "mobidict.app";
    mkdir dist; mv mobidict.dmg dist;
  fi
